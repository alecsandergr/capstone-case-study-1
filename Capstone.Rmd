---
title: "Capstone_Cyclistic"
author: "Alecs"
date: "26 de abril de 2022"
output: html_document
---

## Library

```{r library}
library(tidyverse)
library(lubridate)
library(janitor)
library(skimr)
```

## Loading the datasets

```{r csv}
df_202104 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202104-divvy-tripdata.csv')
df_202105 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202105-divvy-tripdata.csv')
df_202106 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202106-divvy-tripdata.csv')
df_202107 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202107-divvy-tripdata.csv')
df_202108 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202108-divvy-tripdata.csv')
df_202109 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202109-divvy-tripdata.csv')
df_202110 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202110-divvy-tripdata.csv')
df_202111 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202111-divvy-tripdata.csv')
df_202112 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202112-divvy-tripdata.csv')
df_202201 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202201-divvy-tripdata.csv')
df_202202 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202202-divvy-tripdata.csv')
df_202203 <- read.csv('C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/202203-divvy-tripdata.csv')
```

```{r bind}
df_combined <- rbind(df_202104, df_202105, df_202106, df_202107, df_202108, df_202109,
                     df_202110, df_202111, df_202112, df_202201, df_202202, df_202203)
```

## Checking the dataset

```{r glimpse}
glimpse(df_combined)
```


```{r null variables}
colSums(is.na(df_combined))
```

## Statistical evaluation of the whole data

```{r skim}
df_combined %>% 
  skim_without_charts()
```


## Sampling the data
```{r sample}
set.seed(42)
trip_sample <- sample_n(df_combined, 600000)
write.csv(trip_sample, 'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/sample_dataset.csv')
```

### Statistical evaluation of the sample

```{r skim sample}
trip_sample %>% 
  skim_without_charts()
```


## Formating the data

```{r date columns}
trips <- df_combined %>% 
  mutate(
    started_at = ymd_hms(as_datetime(started_at)),
    ended_at = ymd_hms(as_datetime(ended_at))
  )
```

### Getting the day of the trip and the time

```{r weekday}
# wday returns a number (or use label = TRUE, abbr = FALSE), weekdays returns the day
trips_1 <- trips %>% 
  mutate(
    day_week = wday(started_at, label = TRUE, abbr = FALSE),
    month = month(started_at, label = TRUE, abbr = FALSE),
    hour = hour(start_at),
    trip_time = difftime(ended_at, started_at, units = 'mins')
  ) %>% 
  filter(trip_time > 0)
  
```

### Modifying the type

```{r type}
trips_cleaned <- trips_1 %>% 
  mutate(
    rideable_type = recode(as.factor(rideable_type),
                           'classic_bike' = 'classic',
                           'eletric_bike' = 'eletric',
                           'docked_bike' = 'docked'),
    member_casual = as.factor(member_casual)
  )
```

### Checking duplicates

```{r dup}
trips_cleaned %>% 
  get_dupes() %>% 
  tally()
```

### Eliminating nulls

```{r data cleaned}
trips_stations_cleaned <- trips_cleaned %>%
  filter(start_station_name != '') %>% 
  filter(end_station_name != '')
```


## Analyzing the data

### Statistics about all the data

```{r skim data cleaned}
skim_without_charts(trips_cleaned)
```

The mean of trip time is 11.71667 mins and the max is 55944.15 mins.
The mode of day_week is Saturday, while the month is July.

### Statistics about the data without stations with blank spaces

```{r skim data station cleaned}
skim_without_charts(trips_stations_cleaned)
```

## Important results

### Summary by users

```{r trip time for users}
summary_users <- trips_cleaned %>% 
  group_by(member_casual) %>%
  summarise(total_trips_users = n(),
            average_trip_time_users = mean(trip_time),
            sum_trip_time_users = sum(trip_time),
            .groups = 'drop')
summary_users
write.csv(summary_users, 'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/summary_users.csv')
```


### Summary by day

```{r day}
summary_day <- trips_cleaned %>%
  group_by(hour, member_casual) %>%
  summarise(total_trips_day = n(),
            average_trip_time_day = mean(trip_time),
            sum_trip_time_day = sum(trip_time))
summary_day
write.csv(summary_day, 'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/summary_day.csv')
```

### Summary by week

```{r week}
summary_week <- trips_cleaned %>% 
  group_by(day_week, member_casual) %>% 
  summarize(total_trips_week = n(),
            average_trip_time_week = mean(trip_time),
            sum_trip_time_week = sum(trip_time),
            .groups = 'drop')
summary_week
write.csv(number_of_trips_by_month, 'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/summary_week.csv')
```


### Summary by month

```{r month}
summary_month <- trips_cleaned %>% 
  group_by(month, member_casual) %>% 
  summarise(total_trips_month = n(),
            average_trip_time_month = mean(trip_time),
            total_trip_time_month = sum(trip_time))
summary_month
write.csv(number_of_trips_by_month, 'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/summary_month.csv')
```

###  Start stations most used by users

```{r start station}
summary_station <- trips_stations_cleaned %>% 
  group_by(start_station_name, member_casual) %>% 
  summarize(total_trips_start_station = n()) %>% 
  arrange(-total_trips_start_station)
summary_start_station
write.csv(summary_station,'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/summary_start_station.csv')
```

###  Start stations most used by users

```{r end station}
summary_station <- trips_stations_cleaned %>% 
  group_by(start_station_name, member_casual) %>% 
  summarize(total_trips_end_station = n()) %>% 
  arrange(-total_trips_end_station)
summary_end_station
write.csv(summary_station,'C:/Users/USUARIO/OneDrive/Documentos/Cursos/Data Google/Capstone/Data/CSV/summary_end_station.csv')
```

## Graphics

### By users

```{r total trips by user}
summary_users %>%
  ggplot(aes(member_casual, total_trips_users))+
  geom_col(position = 'dodge')+
  labs(
    title = 'Total Trips by User',
    x = 'user',
    y = 'number of trips'
  )
```

```{r average time trip by user}
summary_users %>%
  ggplot(aes(member_casual, average_trip_time_users))+
  geom_col(position = 'dodge')+
  labs(
    title = 'Average of Trip Time by User',
    x = 'user',
    y = 'Average Time in Minutes'
  )
```

```{r sum time trip by user}
summary_users %>%
  ggplot(aes(member_casual, sum_trip_time, users))+
  geom_col(position = 'dodge')+
  labs(
    title = 'Sum of Trip Time by User',
    x = 'user',
    y = 'sum of trip time'
  )
```

### By day
